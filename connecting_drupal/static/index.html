<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title></title>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <script type="text/javascript" src="./js/jquery-1.4.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" >

  

  

  <script type="text/javascript">
  $(function(){
    setupPreso(false, '.');
  });
  </script>
</head>

<body>


<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">&larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">z</td><td>toggle help (this)</td></tr>
  </table>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content full-page" ref="intro/01_bumper">
<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/intro/./background-development-front_berkes.png" width="1024" height="768" alt="Connecting Drupal"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="intro/02_berkes/1">
<h1>Connecting Drupal.</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="intro/02_berkes/2">
<h1>Hello.</h1>

<ul>
<li><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/intro/./Ber_005_BW85x85.png" width="85" height="85" alt="berkes"/></li>
<li>B&#xE8;r Kessels</li>
<li><strong>berkes</strong> @ IRC, twitter, identi.ca, facebook, linkedin, github</li>
<li>webschuur.com / wizzlern.nl</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="intro/02_berkes/3">
<h1>Fork me.</h1>

<ul>
<li>Presentation and demo code on github</li>
<li><a href="http://github.com/berkes/connecting_drupal">http://github.com/berkes/connecting_drupal</a></li>
<li><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/intro/./url_github.png" width="280" height="280" alt="url_qr"/></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="intro/03_presentation/1">
<h1>From Dries' keynote</h1>

<ul>
<li>people will connect to people.</li>
<li>sites will connect to sites.</li>
<li>data will connect to data.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="intro/03_presentation/2">
<h1>This Presentation</h1>

<ul>
<li>is Pragmatic (in the good sense)</li>
<li>Comes from <em>my</em> experience. (YMMV)</li>
<li>Has Some D&#xFC;rer. (Because his work is cool and Public Domain)</li>
<li>Wants your input. (Think about your case, and let us discuss one or two at the end)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="outline/01_bumper">
<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/outline/Early_life_of_Christ_in_the_Bowyer_Bible_print_1_of_21._annunciation_to_Mary._Durer.gif" width="360" height="453" alt="Early_life_of_Christ_in_the_Bowyer_Bible_print_1_of_21._annunciation_to_Mary"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="outline/02_outline">
<h1>Outline</h1>

<ul>
<li>Birdseye: Different types of connections.</li>
<li>Diving in: Connecting your app to a Drupalsite.</li>
<li>Diving in: Connecting Drupal to remote information.</li>
<li>Common pitfalls.</li>
<li>Your case, Discussion, questions</li>
<li>Introducting Melencolia I/Map+Filter (if time permits)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="connecting/01_bumper">
<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/connecting/./Selbstbildnis_mit_Binde.jpg" width="792" height="768" alt="Selfportrait"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/02_birdseye/1">
<h1>Concepts</h1>

<ul>
<li>Drupal <em>Pulls from</em> External [*]</li>
<li>Drupal <em>Pushes into</em> External [**]</li>
<li>External <em>Pulls from</em> Drupal [*]</li>
<li>External <em>Pushes into</em> External [**]</li>
</ul>


<hr/>

<p>[*] Dive into
[**] Skimmed the surface</p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/02_birdseye/2">
<h1>Kinds of data</h1>

<ul>
<li>Mayor <em>content</em> (All content lives elsewhere) [*]</li>
<li>Minor <em>content</em> (e.g. My Latest Tweets) [**]</li>
<li>Major <em>services</em> (Drupal acts as a thin layer around remote service) [*]</li>
<li>Minor <em>services</em> (e.g. push/pull your updates into facebook) [**]</li>
</ul>


<hr/>

<p>[*] Dive into
[**] Skimmed the surface</p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/02_birdseye/3">
<h1>Kinds of Services</h1>

<ul>
<li>SOAP, REST. XML, JSON, etceteras over HTTP (We will cover this).</li>
<li>None HTTP (make them use HTTP).</li>
<li>Javascripted, or activescripted. Client side (We will look at a simple example).</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/03_connecting_to_Drupal/1">
<h1>Connecting your app to Drupal</h1>

<h2>External <em>Pulls from</em> Drupal</h2>

<ul>
<li>Menu-handler</li>
<li>Services</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/03_connecting_to_Drupal/2">
<h1>Menu-handler</h1>

<ul>
<li>Write your own code.</li>
<li>KISS. (performant, managable, quick and to the point)</li>
<li>Not at all hard.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code" ref="connecting/03_connecting_to_Drupal/3">
<h1>Tools</h1>

<pre class="sh_PHP"><code>hook_menu();
  'acces callback' =&gt; check_if_caller_can_use_services();
drupal_json($matches);
SimpleXML::asXML</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="connecting/03_connecting_to_Drupal/4">
<h1>Demo</h1></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/03_connecting_to_Drupal/5">
<h1>Services</h1>

<ul>
<li><a href="http://drupal.org/project/services">http://drupal.org/project/services</a></li>
<li>Expose Views, CCK, nodequeues and so on as services.</li>
<li>Access-control based on various systems. (oAuth, token/key, etceteras)</li>
<li>Featurefull, complex. (40+K, ~6000+lines)</li>
<li>Requires writing views-addons, cck-modules or services addons for custom data.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/03_connecting_to_Drupal/6">
<h1>Pro and Cons</h1>

<ul>
<li>Services offers lots of features.</li>
<li>Services handles POSTs, DELETEs and PUTs.</li>
<li>Services has access control.</li>
<li>Services is complex.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/03_connecting_to_Drupal/7">
<h1>Pro and Cons 2</h1>

<ul>
<li>Menu-handler is simple.</li>
<li>Menu-handler can perform ge-normous.</li>
<li>Menu-handler makes implementing odd Business Logic dead-easy.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/04_connecting_Drupal_to_backend/1">
<h1>Connecting Drupal to a Service</h1>

<h2>Drupal <em>Pulls from</em> External</h2>

<ul>
<li>There is a module that (almost) does that.</li>
<li>FeedAPI.</li>
<li>BatchAPI.</li>
<li>Menu-handler.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/04_connecting_Drupal_to_backend/2">
<h1>Menu-handler</h1>

<ul>
<li>Write your own code.</li>
<li>KISS. (performant, managable, quick and to the point)</li>
<li>Not at all hard.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/04_connecting_Drupal_to_backend/3">
<h1>Demo</h1>

<ul>
<li>Fetch a shop from Etsy.</li>
<li>Just display it.</li>
<li>Oh, no. Actually, only show items whose price &gt;$14,00 [Not included]</li>
<li>And, could you add an advertisement every fourth item? [Not included]</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="connecting/04_connecting_Drupal_to_backend/4">
<h1>And it should look like this</h1>

<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/connecting/./screenshot_mockup.png" width="938" height="481" alt="Screenshot of design"/></p></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="connecting/04_connecting_Drupal_to_backend/5">
<h1>And this is how it works, kinda</h1>

<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/connecting/./callback_route.jpg" width="2576" height="1936" alt="Graph callstack"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="connecting/04_connecting_Drupal_to_backend/6">
<h1>Demo</h1></div>
</div><div class="slide" data-transition="none"><div class="content code" ref="connecting/04_connecting_Drupal_to_backend/7">
<h1>Tools</h1>

<pre class="sh_PHP"><code>hook_menu();
drupal_http_request();
SimpleXML::simple_xml_parse_string();
SOAP::WSDL
drupal::cache_set() &amp;&amp; cache_get();
hook_cron();</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/05_pushing_into_Drupal/1">
<h1>Connecting your app to Drupal: Push</h1>

<h2>External <em>Pushes into</em> Drupal</h2>

<ul>
<li>CRUD: Create, Read, Update, Delete</li>
<li><em>GET</em>, aka Read, is covered in menu-router.</li>
<li>PUT and DELETE are not covered in Drupal other then <em>same as GET</em></li>
<li>POST is handled by FormAPI. We don't want forms.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/05_pushing_into_Drupal/2">
<h1>You are on your own</h1>

<ul>
<li>hook_menu(), with POST, PUT and DELETE handling in menu-callback.</li>
<li>Validate: custom.</li>
<li>Forgery and Bot-protection: custom.</li>
<li>Data handling and processing: custom.</li>
<li>Sorry, bad luck with Drupal</li>
</ul>


<h1>Bad luck? #</h1>

<ul>
<li>As in: it won't help you, as framework.</li>
<li>But it won't (probably) annoy you either.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/05_pushing_into_Drupal/3">
<h1>Alternative: Services</h1>

<ul>
<li>offers POST handling.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="connecting/06_pushing_into_remote">
<h1>Pushing data from Drupal into Remote</h1>

<ul>
<li>There is a module that (almost) does that.</li>
<li>Just run your own code:</li>
<li><code>hook_form_alter()</code>, adds a <em>submit callback</em>, which pushes data into remote.</li>
<li>Be carefull with <em>actions</em>, often cannot handle errors from remote.</li>
<li>(<em>you must</em> handle errors from remote, submit-callback is not atomic!)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/1">
<h1>Common pitfalls</h1>

<ul>
<li>Synchronisation</li>
<li>Synchronisation</li>
<li>and Synchronisation</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/2">
<h1>Avoid Synchronisation #</h1>

<ul>
<li>but Cache.</li>
<li>GETs can be <code>cache_set(); cache_get();</code>-ed.</li>
<li>POSTs, PUTs and DELETEs can be queued. Write your own spool-queue (Drupal has no general one).</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/3">
<h1>Other common pitfalls</h1>

<h2>Drupal has a database abstraction layer, can we not add our services to that?</h2>

<ul>
<li>DBA in Drupal (6) is only a way to allow postgreSQL for the Brave Few.</li>
<li>DBA in Drupal 7 is a way to abstract SQL databases. Not something non-SQLish.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/4">
<h1>Other common pitfalls</h1>

<h2>Attempting a generalised solution.</h2>

<ul>
<li>Putting stuff into Nodes, Taxonomy, CCK, and Views</li>
<li>Requires synchronisation.</li>
<li>CCK is tightly coupled to the <em>relational</em> database</li>
<li>Avoid nodes.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/5">
<h1>Pitfall: Nodes</h1>

<ul>
<li>All content on a Drupal website is <strong>stored</strong> and treated as "nodes."</li>
<li><p>A node is any <strong>posting</strong>, such as a page, poll, story, forum text, or blog entry.</p></li>
<li><p>Stored: Database (synchronisation)</p></li>
<li>Postings: Articles (is it an article)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/6">
<h1>Other common pitfalls</h1>

<h2>Running out of IDs.</h2>

<ul>
<li>Don't use Drupal-thingies to store/cache remote-thingies: avoids using keys.</li>
<li>That also avoids synchronisation.</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="pitfalls/01_syncronise/7">
<h1>Other common pitfalls</h1>

<h2>Attempt to make Drupal "a thin layer around an app".</h2>

<ul>
<li>Keep things slim, KISS.</li>
<li>Write your own modules, use it as framework: else it is no "thin layer", but a vast, complex beast.</li>
<li>Write your own CMS/APP, dedicated. With Drupalisms (dabr).</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content !slide full-page" ref="discuss/01_bumper">
<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/discuss/./Michaels_Kampf_mit_dem_Drachen.jpg" width="1232" height="1577" alt="Selfportrait"/></p></div>
</div><div class="slide" data-transition="none"><div class="content" ref="discuss/02_discuss">
<h1>Your case.</h1></div>
</div><div class="slide" data-transition="none"><div class="content center" ref="melencolia_I/01_melencolia/1">
<p><img src="file:///home/ber/Documenten/CPH_drupalcon_cph/code/connecting_drupal/melencolia_I/./Melencolia_I.jpg" width="555" height="578" alt="Melencolia I"/></p></div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="melencolia_I/01_melencolia/2">
<h1>Melencolia#</h1>

<ul>
<li>A (really) simple mapper.</li>
<li>A (really) simple reducer.</li>
<li>Not to be confused with Map/Reduce</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="melencolia_I/01_melencolia/3">
<h1>Melencolia#</h1>

<ul>
<li>Each field can be included</li>
<li>Each field can be processed <em>(Busyness Logic)</em></li>
<li>Each field can be combined</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="melencolia_I/01_melencolia/4">
<h1>Example</h1>

<pre class="sh_PHP"><code> function _ub_search_api_metafilter_filters() {
  $filter = array(
    'price' =&gt; array(
      'name'     =&gt; t('Price'),
      'callback' =&gt; 
            '_ub_search_api_metafilter_format_price',
    ),
  );

  return $filter;
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="melencolia_I/01_melencolia/5">
<pre class="sh_PHP"><code>/**
 * Callback formatter for "price" fields
 *
 * @param $value
 *   Description of param $value
 *
 * @return
 *   Description of return value
 */
function _ub_search_api_metafilter_format_price($value) {
  if ($value == 0 | (int)$value == 0) {
    return t('free');
  }
  else {
    $price = sprintf('%.2f', $value);
    return t('&#x20AC; %price', array('%price' =&gt; $price));
  }
}</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="melencolia_I/01_melencolia/6">
<h1>Example "Just include"</h1>

<pre class="sh_PHP"><code>'genre' =&gt; array(
  'name' =&gt; t('Genre or Sort'),
),</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="melencolia_I/01_melencolia/7">
<h1>Example "Callback: any function" #</h1>

<pre class="sh_PHP"><code>'aantal_zitplaatsen' =&gt; array(
  'name' =&gt; t('Seats'),
  'callback' =&gt; 'intval', // It is perfectly fine to 
                          // define callbacks that 
                          // are core PHP functions. 
),</code></pre></div>
</div><div class="slide" data-transition="none"><div class="content code small" ref="melencolia_I/01_melencolia/8">
<h1>Example "Callback: include extra fields" #</h1>

<pre class="sh_PHP"><code>'title' =&gt; array(
  'name' =&gt; t('Title'),
  'callback' =&gt; '_ub_search_api_metafilter_format_title',
  'callback arguments' =&gt; array('datetime-start',
                             'datetime-end'), 
        //In addition to the $value, you can provide 
        // extra fields to be passed along to the callback.
),</code></pre></div>
</div>
</div>

</body>
</html>
